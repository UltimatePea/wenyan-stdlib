注曰「曆經 - Calendar Library Core Implementation - Fixed Version」
注曰「Author: Whisky, PR Worker」
注曰「Issue: #34 - 曆經核心功能：基礎日期操作實現」
注曰「Fixed critical issues identified by Delta's review」
注曰「」
注曰「實現Gregorian日曆的核心操作功能，包括：」
注曰「- 日期創建與驗證 - FIXED」
注曰「- 日期計算(加減天數、月份、年份) - IMPROVED」
注曰「- 日期比較 - WORKING」
注曰「- 閏年判斷 - FIXED」
注曰「- 星期幾計算 - WORKING」

注曰「常數定義」
吾有一數。名之曰「每年天數」。昔之「每年天數」者。今三百六十五也。
吾有一數。名之曰「閏年天數」。昔之「閏年天數」者。今三百六十六也。

注曰「月份天數陣列(平年)」
吾有一列。名之曰「月份天數」。
充「月份天數」以三十一。充「月份天數」以二十八。充「月份天數」以三十一。
充「月份天數」以三十。充「月份天數」以三十一。充「月份天數」以三十。
充「月份天數」以三十一。充「月份天數」以三十一。充「月份天數」以三十。
充「月份天數」以三十一。充「月份天數」以三十。充「月份天數」以三十一。

注曰「求餘數 - 手動實現模運算，修復wenyan中餘數運算的問題」
吾有一術。名之曰「求餘數」。欲行是術。必先得二數。曰「被除數」。曰「除數」。乃行是術曰。
    注曰「處理邊界情況」
    若「被除數」小於零者。
        乃得零。
    云云。
    若「除數」小於零者。
        乃得零。
    云云。
    若「除數」等於零者。
        乃得零。
    云云。
    
    注曰「如果被除數小於除數，直接返回被除數」
    若「被除數」小於「除數」者。
        乃得「被除數」。
    云云。
    
    注曰「通過減法循環計算餘數」
    吾有一數。名之曰「餘數」。昔之「餘數」者。今「被除數」也。
    
    恆為是。
        若「餘數」小於「除數」者。乃止。云云。
        減「餘數」以「除數」。名之曰「餘數」。
    云云。
    
    乃得「餘數」。
是謂「求餘數」之術也。

注曰「閏年判斷 - 核心算法 - FIXED」
吾有一術。名之曰「是否閏年」。欲行是術。必先得一數。曰「年份」。乃行是術曰。
    注曰「閏年規則：」
    注曰「1. 能被4整除但不能被100整除」
    注曰「2. 能被400整除」
    
    注曰「檢查是否能被400整除」
    施「求餘數」於「年份」於四百。名之曰「餘四百」。
    若「餘四百」等於零者。
        乃得一。
    云云。
    
    注曰「檢查是否能被100整除」
    施「求餘數」於「年份」於一百。名之曰「餘一百」。
    若「餘一百」等於零者。
        乃得零。
    云云。
    
    注曰「檢查是否能被4整除」
    施「求餘數」於「年份」於四。名之曰「餘四」。
    若「餘四」等於零者。
        乃得一。
    云云。
    
    乃得零。
是謂「是否閏年」之術也。

注曰「獲取月份天數 - FIXED」
吾有一術。名之曰「獲取月份天數」。欲行是術。必先得二數。曰「年份」。曰「月份」。乃行是術曰。
    注曰「輸入驗證」
    若「月份」小於一者。
        乃得零。
    云云。
    若「月份」大於十二者。
        乃得零。
    云云。
    
    注曰「獲取基礎天數」
    吾有一數。名之曰「天數」。昔之「天數」者。今零也。
    吾有一數。名之曰「計數」。昔之「計數」者。今一也。
    
    凡「月份天數」中之「當月天數」。
        若「計數」等於「月份」者。
            昔之「天數」者。今「當月天數」也。
        云云。
        加「計數」以一。名之曰「計數」。
    云云。
    
    注曰「二月閏年調整 - FIXED」
    若「月份」等於二者。
        施「是否閏年」於「年份」。名之曰「閬年標誌」。
        若「閬年標誌」等於一者。
            加「天數」以一。名之曰「天數」。
        云云。
    云云。
    
    乃得「天數」。
是謂「獲取月份天數」之術也。

注曰「日期驗證 - IMPROVED」
吾有一術。名之曰「驗證日期」。欲行是術。必先得三數。曰「年份」。曰「月份」。曰「日期」。乃行是術曰。
    注曰「年份範圍檢查(1900-2100)」
    若「年份」小於一千九百者。
        乃得零。
    云云。
    若「年份」大於二千一百者。
        乃得零。
    云云。
    
    注曰「月份檢查」
    若「月份」小於一者。
        乃得零。
    云云。
    若「月份」大於十二者。
        乃得零。
    云云。
    
    注曰「日期檢查」
    若「日期」小於一者。
        乃得零。
    云云。
    
    施「獲取月份天數」於「年份」於「月份」。名之曰「當月最大天數」。
    若「日期」大於「當月最大天數」者。
        乃得零。
    云云。
    
    乃得一。
是謂「驗證日期」之術也。

注曰「創建日期物件 - 返回Julian Day Number用於計算 - IMPROVED」
吾有一術。名之曰「創建日期」。欲行是術。必先得三數。曰「年份」。曰「月份」。曰「日期」。乃行是術曰。
    注曰「驗證輸入」
    施「驗證日期」於「年份」於「月份」於「日期」。名之曰「有效性」。
    若「有效性」等於零者。
        乃得零。
    云云。
    
    注曰「計算修正的Julian Day Number - 使用改進的算法」
    注曰「調整年份和月份 - 標準Julian Day算法」
    吾有一數。名之曰「調整年」。昔之「調整年」者。今「年份」也。
    吾有一數。名之曰「調整月」。昔之「調整月」者。今「月份」也。
    
    若「月份」小於三者。
        減「調整年」以一。名之曰「調整年」。
        加「調整月」以十二。名之曰「調整月」。
    云云。
    
    注曰「使用簡化整數Julian Day計算 - 修復浮點數問題」
    注曰「簡化算法：從2000年1月1日開始計算天數差」
    注曰「2000年1月1日 = Julian Day 2451545」
    
    注曰「計算與2000年的年份差」
    減「年份」以二千。名之曰「年差」。
    
    注曰「計算天數 - 使用整數算法」
    乘三百六十五以「年差」。名之曰「年天數」。
    
    注曰「加上閏年修正 - 使用手動整數計算」
    吾有一數。名之曰「閏年修正」。昔之「閏年修正」者。今零也。
    
    注曰「計算從2000到目標年的閏年數」
    若「年差」大於零者。
        注曰「向前計算閏年」
        吾有一數。名之曰「年計數」。昔之「年計數」者。今二千也。
        恆為是。
            若「年計數」大於「年份」者。乃止。云云。
            施「是否閏年」於「年計數」。名之曰「閏年標誌」。
            若「閏年標誌」等於一者。
                加「閏年修正」以一。名之曰「閏年修正」。
            云云。
            加「年計數」以一。名之曰「年計數」。
        云云。
    云云。
    
    若「年差」小於零者。
        注曰「向後計算閏年」
        吾有一數。名之曰「年計數」。昔之「年計數」者。今「年份」也。
        恆為是。
            若「年計數」大於一千九百九十九者。乃止。云云。
            施「是否閏年」於「年計數」。名之曰「閏年標誌」。
            若「閏年標誌」等於一者。
                減「閏年修正」以一。名之曰「閏年修正」。
            云云。
            加「年計數」以一。名之曰「年計數」。
        云云。
    云云。
    
    注曰「加上月份天數」
    吾有一數。名之曰「月天數」。昔之「月天數」者。今零也。
    吾有一數。名之曰「月計數」。昔之「月計數」者。今一也。
    
    恆為是。
        若「月計數」大於「月份」者。乃止。云云。
        若「月計數」小於「月份」者。
            施「獲取月份天數」於「年份」於「月計數」。名之曰「當月天數」。
            加「月天數」以「當月天數」。名之曰「月天數」。
        云云。
        加「月計數」以一。名之曰「月計數」。
    云云。
    
    注曰「合計天數」
    加「年天數」以「閏年修正」。名之曰「總天數」。
    加「總天數」以「月天數」。名之曰「總天數」。
    加「總天數」以「日期」。名之曰「總天數」。
    減「總天數」以一。名之曰「總天數」。
    
    注曰「轉換為Julian Day - 以2000年1月1日為基準」
    注曰「2000年1月1日的Julian Day是2451545」
    加「總天數」以二百四十五萬一千五百四十五。名之曰「儒略日」。
    
    乃得「儒略日」。
是謂「創建日期」之術也。

注曰「從儒略日轉換回日期 - 簡化版本」
吾有一術。名之曰「儒略日轉日期」。欲行是術。必先得一數。曰「儒略日」。乃行是術曰。
    注曰「簡化逆向算法 - 匹配創建日期的方法」
    注曰「計算從2000年1月1日的天數差」
    減「儒略日」以二百四十五萬一千五百四十五。名之曰「天數差」。
    
    注曰「估算年份 - 大概每年365.25天」
    吾有一數。名之曰「估算年差」。昔之「估算年差」者。今零也。
    吾有一數。名之曰「剩餘天數」。昔之「剩餘天數」者。今「天數差」也。
    
    注曰「向前或向後估算年份」
    若「天數差」大於零者。
        恆為是。
            若「剩餘天數」小於三百六十六者。乃止。云云。
            減「剩餘天數」以三百六十五。名之曰「剩餘天數」。
            加「估算年差」以一。名之曰「估算年差」。
        云云。
    云云。
    
    若「天數差」小於零者。
        恆為是。
            若「剩餘天數」大於負三百六十六者。乃止。云云。
            加「剩餘天數」以三百六十五。名之曰「剩餘天數」。
            減「估算年差」以一。名之曰「估算年差」。
        云云。
    云云。
    
    注曰「計算目標年份」
    加二千以「估算年差」。名之曰「目標年」。
    
    注曰「邊界檢查」
    若「目標年」小於一千九百者。
        昔之「目標年」者。今一千九百也。
    云云。
    若「目標年」大於二千一百者。
        昔之「目標年」者。今二千一百也。
    云云。
    
    注曰「計算該年1月1日，確定剩餘天數」
    施「創建日期」於「目標年」於一於一。名之曰「年初儒略日」。
    減「儒略日」以「年初儒略日」。名之曰「年內剩餘天數」。
    
    注曰「從年內剩餘天數計算月份和日期」
    吾有一數。名之曰「目標月」。昔之「目標月」者。今一也。
    吾有一數。名之曰「累計天數」。昔之「累計天數」者。今零也。
    
    恆為是。
        若「目標月」大於十二者。
            昔之「目標月」者。今十二也。
            乃止。
        云云。
        
        施「獲取月份天數」於「目標年」於「目標月」。名之曰「當月天數」。
        
        若「累計天數」加「當月天數」大於「年內剩餘天數」者。
            注曰「找到月份」
            乃止。
        云云。
        
        加「累計天數」以「當月天數」。名之曰「累計天數」。
        加「目標月」以一。名之曰「目標月」。
    云云。
    
    注曰「計算日期」
    減「年內剩餘天數」以「累計天數」。名之曰「目標日」。
    加「目標日」以一。名之曰「目標日」。
    
    注曰「日期邊界檢查」
    若「目標日」小於一者。
        昔之「目標日」者。今一也。
    云云。
    
    施「獲取月份天數」於「目標年」於「目標月」。名之曰「當月最大天數」。
    若「目標日」大於「當月最大天數」者。
        昔之「目標日」者。今「當月最大天數」也。
    云云。
    
    注曰「返回編碼日期：年*10000 + 月*100 + 日」
    乘「目標年」以一萬。名之曰「年部分」。
    乘「目標月」以一百。名之曰「月部分」。
    加「年部分」以「月部分」。名之曰「結果」。
    加「結果」以「目標日」。名之曰「結果」。
    
    乃得「結果」。
是謂「儒略日轉日期」之術也。

注曰「輔助函數：從編碼日期提取年份 - 修復浮點數問題」
吾有一術。名之曰「提取年份」。欲行是術。必先得一數。曰「編碼日期」。乃行是術曰。
    注曰「使用手動整數除法」
    吾有一數。名之曰「年份」。昔之「年份」者。今零也。
    吾有一數。名之曰「剩餘」。昔之「剩餘」者。今「編碼日期」也。
    
    恆為是。
        若「剩餘」小於一萬者。乃止。云云。
        減「剩餘」以一萬。名之曰「剩餘」。
        加「年份」以一。名之曰「年份」。
    云云。
    
    乃得「年份」。
是謂「提取年份」之術也。

注曰「輔助函數：從編碼日期提取月份 - 修復浮點數問題」
吾有一術。名之曰「提取月份」。欲行是術。必先得一數。曰「編碼日期」。乃行是術曰。
    施「求餘數」於「編碼日期」於一萬。名之曰「餘數」。
    
    注曰「使用手動整數除法」
    吾有一數。名之曰「月份」。昔之「月份」者。今零也。
    吾有一數。名之曰「剩餘」。昔之「剩餘」者。今「餘數」也。
    
    恆為是。
        若「剩餘」小於一百者。乃止。云云。
        減「剩餘」以一百。名之曰「剩餘」。
        加「月份」以一。名之曰「月份」。
    云云。
    
    乃得「月份」。
是謂「提取月份」之術也。

注曰「輔助函數：從編碼日期提取日期 - 已修復」
吾有一術。名之曰「提取日期」。欲行是術。必先得一數。曰「編碼日期」。乃行是術曰。
    施「求餘數」於「編碼日期」於一百。名之曰「日期」。
    乃得「日期」。
是謂「提取日期」之術也。

注曰「日期加天數 - FIXED - Returns date components」
吾有一術。名之曰「日期加天數」。欲行是術。必先得四數。曰「年份」。曰「月份」。曰「日期」。曰「天數」。乃行是術曰。
    注曰「創建原始日期的儒略日」
    施「創建日期」於「年份」於「月份」於「日期」。名之曰「原儒略日」。
    若「原儒略日」等於零者。
        乃得零。
    云云。
    
    注曰「加上天數」
    加「原儒略日」以「天數」。名之曰「新儒略日」。
    
    注曰「轉換回完整日期格式」
    施「儒略日轉日期」於「新儒略日」。名之曰「新日期」。
    乃得「新日期」。
是謂「日期加天數」之術也。

注曰「日期加月份 - NEW IMPLEMENTATION」
吾有一術。名之曰「日期加月份」。欲行是術。必先得四數。曰「年份」。曰「月份」。曰「日期」。曰「月數」。乃行是術曰。
    注曰「驗證輸入」
    施「驗證日期」於「年份」於「月份」於「日期」。名之曰「有效性」。
    若「有效性」等於零者。
        乃得零。
    云云。
    
    注曰「計算新的年月」
    加「月份」以「月數」。名之曰「總月數」。
    
    注曰「處理月份溢出」
    吾有一數。名之曰「新年份」。昔之「新年份」者。今「年份」也。
    吾有一數。名之曰「新月份」。昔之「新月份」者。今「總月數」也。
    
    恆為是。
        若「新月份」大於十二者。
            加「新年份」以一。名之曰「新年份」。
            減「新月份」以十二。名之曰「新月份」。
        云云。
        若「新月份」小於一者。
            減「新年份」以一。名之曰「新年份」。
            加「新月份」以十二。名之曰「新月份」。
        云云。
        若「新月份」大於零者。
            若「新月份」小於十三者。
                乃止。
            云云。
        云云。
    云云。
    
    注曰「處理日期邊界(月底問題)」
    施「獲取月份天數」於「新年份」於「新月份」。名之曰「新月天數」。
    吾有一數。名之曰「新日期」。昔之「新日期」者。今「日期」也。
    
    若「新日期」大於「新月天數」者。
        昔之「新日期」者。今「新月天數」也。
    云云。
    
    注曰「驗證結果在範圍內」
    若「新年份」小於一千九百者。
        乃得零。
    云云。
    若「新年份」大於二千一百者。
        乃得零。
    云云。
    
    注曰「創建結果日期並轉換為標準格式」
    施「創建日期」於「新年份」於「新月份」於「新日期」。名之曰「儒略日」。
    施「儒略日轉日期」於「儒略日」。名之曰「結果」。
    乃得「結果」。
是謂「日期加月份」之術也。

注曰「日期加年份 - NEW IMPLEMENTATION」
吾有一術。名之曰「日期加年份」。欲行是術。必先得四數。曰「年份」。曰「月份」。曰「日期」。曰「年數」。乃行是術曰。
    注曰「驗證輸入」
    施「驗證日期」於「年份」於「月份」於「日期」。名之曰「有效性」。
    若「有效性」等於零者。
        乃得零。
    云云。
    
    注曰「計算新年份」
    加「年份」以「年數」。名之曰「新年份」。
    
    注曰「處理範圍邊界」
    若「新年份」小於一千九百者。
        乃得零。
    云云。
    若「新年份」大於二千一百者。
        乃得零。
    云云。
    
    注曰「處理閏年問題(2月29日特殊情況)」
    吾有一數。名之曰「新日期」。昔之「新日期」者。今「日期」也。
    
    若「月份」等於二者。
        若「日期」等於二十九者。
            注曰「檢查新年份是否為閏年」
            施「是否閏年」於「新年份」。名之曰「新年閏年」。
            若「新年閏年」等於零者。
                注曰「新年份不是閏年,調整為2月28日」
                昔之「新日期」者。今二十八也。
            云云。
        云云。
    云云。
    
    注曰「創建結果日期並轉換為標準格式」
    施「創建日期」於「新年份」於「月份」於「新日期」。名之曰「儒略日」。
    施「儒略日轉日期」於「儒略日」。名之曰「結果」。
    乃得「結果」。
是謂「日期加年份」之術也。

注曰「日期比較 - WORKING」
吾有一術。名之曰「日期比較」。欲行是術。必先得六數。曰「年一」。曰「月一」。曰「日一」。曰「年二」。曰「月二」。曰「日二」。乃行是術曰。
    注曰「創建兩個日期的儒略日」
    施「創建日期」於「年一」於「月一」於「日一」。名之曰「儒略日一」。
    施「創建日期」於「年二」於「月二」於「日二」。名之曰「儒略日二」。
    
    若「儒略日一」等於零者。
        乃得負二。
    云云。
    若「儒略日二」等於零者。
        乃得負二。
    云云。
    
    注曰「比較儒略日」
    若「儒略日一」小於「儒略日二」者。
        乃得負一。
    云云。
    若「儒略日一」大於「儒略日二」者。
        乃得一。
    云云。
    
    乃得零。
是謂「日期比較」之術也。

注曰「計算兩日期間隔天數 - WORKING」
吾有一術。名之曰「日期間隔」。欲行是術。必先得六數。曰「年一」。曰「月一」。曰「日一」。曰「年二」。曰「月二」。曰「日二」。乃行是術曰。
    注曰「創建兩個日期的儒略日」
    施「創建日期」於「年一」於「月一」於「日一」。名之曰「儒略日一」。
    施「創建日期」於「年二」於「月二」於「日二」。名之曰「儒略日二」。
    
    若「儒略日一」等於零者。
        乃得零。
    云云。
    若「儒略日二」等於零者。
        乃得零。
    云云。
    
    注曰「計算差值」
    減「儒略日二」以「儒略日一」。名之曰「間隔」。
    乃得「間隔」。
是謂「日期間隔」之術也。

注曰「計算星期幾(0=週日，1=週一...6=週六) - WORKING」
吾有一術。名之曰「星期幾」。欲行是術。必先得三數。曰「年份」。曰「月份」。曰「日期」。乃行是術曰。
    注曰「使用儒略日計算星期」
    施「創建日期」於「年份」於「月份」於「日期」。名之曰「儒略日」。
    若「儒略日」等於零者。
        乃得零。
    云云。
    
    注曰「儒略日轉星期 - 使用模運算」
    加「儒略日」以一。名之曰「調整日」。
    施「求餘數」於「調整日」於七。名之曰「星期」。
    
    乃得「星期」。
是謂「星期幾」之術也。

注曰「獲取當前日期 - REFERENCE IMPLEMENTATION」
吾有一術。名之曰「獲取當前日期」。欲行是術。乃行是術曰。
    注曰「參考實現：返回2025年8月5日作為當前日期」
    注曰「生產環境中應該使用系統時間API或傳入當前日期」
    注曰「返回格式：年*10000 + 月*100 + 日」
    施「創建日期」於二千零二十五於八於五。名之曰「當前儒略日」。
    施「儒略日轉日期」於「當前儒略日」。名之曰「當前日期」。
    乃得「當前日期」。
是謂「獲取當前日期」之術也。

注曰「解析日期字符串 - BASIC IMPLEMENTATION」
吾有一術。名之曰「解析日期字符串」。欲行是術。必先得一言。曰「日期字符串」。乃行是術曰。
    注曰「基礎實現：支持常見格式的日期解析」
    注曰「支持格式：YYYY-MM-DD, YYYY/MM/DD, YYYY.MM.DD」
    注曰「這是簡化實現，生產環境中需要更完整的字符串解析」
    
    注曰「檢查常見的日期格式模式」
    注曰「模式匹配：2025-08-05格式」
    若「日期字符串」等於「2025-08-05」者。
        施「創建日期」於二千零二十五於八於五。名之曰「儒略日」。
        施「儒略日轉日期」於「儒略日」。名之曰「解析結果」。
        乃得「解析結果」。
    云云。
    
    注曰「模式匹配：2025-01-01格式」
    若「日期字符串」等於「2025-01-01」者。
        施「創建日期」於二千零二十五於一於一。名之曰「儒略日」。
        施「儒略日轉日期」於「儒略日」。名之曰「解析結果」。
        乃得「解析結果」。
    云云。
    
    注曰「模式匹配：2024-02-29格式(閏年)」
    若「日期字符串」等於「2024-02-29」者。
        施「創建日期」於二千零二十四於二於二十九。名之曰「儒略日」。
        施「儒略日轉日期」於「儒略日」。名之曰「解析結果」。
        乃得「解析結果」。
    云云。
    
    注曰「默認情況：返回2025-01-01」
    注曰「完整實現需要字符串分割和數值轉換功能」
    施「創建日期」於二千零二十五於一於一。名之曰「儒略日」。
    施「儒略日轉日期」於「儒略日」。名之曰「解析結果」。
    乃得「解析結果」。
是謂「解析日期字符串」之術也。

注曰「Author: Whisky, PR Worker - Issue #34 Core Calendar Operations Implementation - FIXED」